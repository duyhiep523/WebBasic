<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        function evaluateMathExpression(expression) {
            // Hàm kiểm tra xem một ký tự có phải là toán tử hay không
            function isOperator(char) {
                return ['+', '-', '*', '/'].includes(char);
            }

            // Hàm ưu tiên của các toán tử
            function getPrecedence(operator) {
                if (operator === '+' || operator === '-') {
                    return 1;
                } else if (operator === '*' || operator === '/') {
                    return 2;
                }
                return 0;
            }

            // Hàm chuyển đổi biểu thức trung tố sang hậu tố
            function convertToPostfix(expression) {
                let outputQueue = [];
                let operatorStack = [];

                // Tách chuỗi thành các thành phần riêng biệt (số hoặc toán tử)
                let tokens = expression.split(/\s+/);

                tokens.forEach((token) => {
                    if (!isNaN(token)) {
                        // Nếu là số, thêm vào hàng đợi kết quả đầu ra
                        outputQueue.push(parseFloat(token));
                    } else if (isOperator(token)) {
                        // Nếu là toán tử, kiểm tra ưu tiên và đẩy các toán tử có ưu tiên cao hơn ra khỏi ngăn xếp
                        while (
                            operatorStack.length > 0 &&
                            isOperator(operatorStack[operatorStack.length - 1]) &&
                            getPrecedence(operatorStack[operatorStack.length - 1]) >= getPrecedence(token)
                        ) {
                            outputQueue.push(operatorStack.pop());
                        }
                        operatorStack.push(token);
                    }
                });

                // Đẩy toàn bộ toán tử còn lại trong ngăn xếp vào hàng đợi kết quả đầu ra
                while (operatorStack.length > 0) {
                    outputQueue.push(operatorStack.pop());
                }

                return outputQueue;
            }

            // Hàm tính toán kết quả từ biểu thức hậu tố
            function evaluatePostfix(postfixExpression) {
                let operandStack = [];

                postfixExpression.forEach((token) => {
                    if (!isNaN(token)) {
                        // Nếu là số, đẩy vào ngăn xếp toán hạng
                        operandStack.push(token);
                    } else if (isOperator(token)) {
                        // Nếu là toán tử, lấy hai toán hạng cuối cùng từ ngăn xếp và thực hiện phép tính
                        let operand2 = operandStack.pop();
                        let operand1 = operandStack.pop();

                        switch (token) {
                            case '+':
                                operandStack.push(operand1 + operand2);
                                break;
                            case '-':
                                operandStack.push(operand1 - operand2);
                                break;
                            case '*':
                                operandStack.push(operand1 * operand2);
                                break;
                            case '/':
                                operandStack.push(operand1 / operand2);
                                break;
                        }
                    }
                });

                // Kết quả cuối cùng sẽ nằm trong ngăn xếp toán hạng
                return operandStack.pop();
            }

            // Chuyển đổi biểu thức sang dạng hậu tố và tính toán kết quả
            let postfixExpression = convertToPostfix(expression);
            let result = evaluatePostfix(postfixExpression);

            return result;
        }

        // Ví dụ sử dụng
        let mathExpression = ""; // Biểu thức: 3 + 4 * 2 / ( 1 - 5 ) = 1
        let result = evaluateMathExpression(mathExpression);
        console.log(result); // Kết quả: 1
    </script>
</body>

</html>